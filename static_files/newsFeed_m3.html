<html lang="en">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
        <title>NewsFeed Page</title>
        <link rel="stylesheet" href="styles.css">

        <script src="https://code.jquery.com/jquery-3.3.1.js"></script>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
                               integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

        <script type="text/javascript">

            $(document).ready(() => {

                var toggle_US = true;
                var baseurl =
                    'https://api.reliefweb.int/v1/reports?appname=apidoc&query[value]=wildfire&';
                var params;
                var filters = 'filter[operator]=AND&filter[conditions][0][field]=country&filter[conditions][0][value]=USA&filter[conditions][1][field]=body&profile=full';
                var filters_World =
'filter[operator]=OR&filter[conditions][0][field]=country&filter[conditions][0][value]=USA&filter[conditions][0][negate]=true&filter[conditions][1][field]=body&profile=full'; 
                var article_IDs = [];
                var articles;

                //Initial page loading 
                $.ajax({
                    url: baseurl + filters,
                    type: 'GET',
                    dataType: 'json',
                    success: (res) => {
                        console.log(res);
                        $('.article-header').each((index,element) => {
                            element.innerHTML = res.data[index].fields.title
                            article_IDs[index] = res.data[index].id
                            articles = res;
                        });
                        $('.article-body').each((index,element) => {
                            element.innerHTML =
                                res.data[index].fields.body.split(' ').slice(0,30).join(' ') + '...';
                        });
                        console.log(articles);
                    }
                });


                //Learn More click
                $('.learnBut').click(function(event) {
                    var but_index = event.target.id.slice(-1);
                    console.log(but_index);

                    //Pull up individual page
                    var targetID = articles.data[but_index - 1].id
                    console.log(targetID)
                    window.location.href =
                        '/newsProfile.html?id='+targetID+'&toggle_US='+toggle_US;
                });


                /*           $('#learnBut2').click( () => { 
                    if (toggle_US==false) {
                        filters = 'filter[operator]=OR&filter[conditions][0][field]=country&filter[conditions][0][value]=USA&filter[conditions][0][negate]=true&filter[conditions][1][field]=body&profile=full&limit=3' 
                    }
                    else {
                        filters = 'filter[operator]=AND&filter[conditions][0][field]=country&filter[conditions][0][value]=USA&filter[conditions][1][field]=body&profile=full&limit=3'
                    }
                    $.ajax({
                        url: 'https://api.reliefweb.int/v1/reports?appname=apidoc&query[value]=wildfire&' + filters,
                        type: 'GET',
                        dataType: 'json',
                        success: (res) => {
                            console.log(res);
                            document.getElementById(("news"+2+"Text")).innerHTML = res.data[1].fields.body;
                            $('#news2Text').append('<button id="but_donate2" type="button" class="btn btn-cust">Donate</button> <button id="but_volunteer2" type="button" class="btn btn-cust">Volunteer</button>');
//Donate & Vol click
                            $('#but_donate2').click(() => {
                                alert("You have clicked donate!")
                            });

                            $('#but_volunteer2').click(() => {
                                alert("You have clicked volunteer!")
                            });


                        }
                    });
                });
                 */


//Toggle location filter
$('#butNewsWorld').click( () => {
    toggle_US = false;
    $.ajax({        
        url: 'https://api.reliefweb.int/v1/reports?appname=apidoc&query[value]=wildfire&filter[operator]=OR&filter[conditions][0][field]=country&filter[conditions][0][value]=USA&filter[conditions][0][negate]=true&filter[conditions][1][field]=body&profile=full',
        type: 'GET',
        dataType: 'json',
        success: (res) => {
            console.log(res);
            articles = res;
            $('.article-header').each((index,element) => {
                console.log('world clicked!');
                element.innerHTML = res.data[index].fields.title
                document.getElementById(("news1Text")).innerHTML ="";
                document.getElementById(("news2Text")).innerHTML ="";
                document.getElementById(("news3Text")).innerHTML ="";

            });
            $('.article-body').each((index,element) => {
                element.innerHTML =
                    res.data[index].fields.body.split(' ').slice(0,30).join(' ') + '...';
            });


        }



    });

});

                $('#butNewsUS').click( () => {
                    toggle_US = true;
                    $.ajax({    
                        url: 'https://api.reliefweb.int/v1/reports?appname=apidoc&query[value]=wildfire&filter[operator]=AND&filter[conditions][0][field]=country&filter[conditions][0][value]=USA&filter[conditions][1][field]=body&profile=full&limit=3',    
                        type: 'GET',
                        dataType: 'json',
                        success: (res) => {
                            console.log(res);
                            articles = res;
                            $('.article-header').each((index,element) => {
                                console.log('U.S. clicked!');
                                element.innerHTML = res.data[index].fields.title
                                document.getElementById(("news1Text")).innerHTML ="";
                                document.getElementById(("news2Text")).innerHTML ="";
                                document.getElementById(("news3Text")).innerHTML ="";

                            });
                            $('.article-body').each((index,element) => {
                            element.innerHTML =
                                res.data[index].fields.body.split(' ').slice(0,30).join(' ') + '...';
                        });
        
                        }



                    });

                });


                $('#page_0').click( () => {
                    if (toggle_US==false) {
                        filters = 'filter[operator]=OR&filter[conditions][0][field]=country&filter[conditions][0][value]=USA&filter[conditions][0][negate]=true&filter[conditions][1][field]=body&profile=full&limit=3' 
                    }
                    else {
                        filters = 'filter[operator]=AND&filter[conditions][0][field]=country&filter[conditions][0][value]=USA&filter[conditions][1][field]=body&profile=full&limit=3'
                    }
                    $.ajax({    
                        url: 'https://api.reliefweb.int/v1/reports?appname=apidoc&query[value]=wildfire&' + filters,    
                        type: 'GET',
                        dataType: 'json',
                        success: (res) => {
                            console.log(res);
                            articles = res;
                            $('.article-header').each((index,element) => {
                                console.log('U.S. clicked!');
                                element.innerHTML = res.data[index].fields.title
                                document.getElementById(("news1Text")).innerHTML ="";
                                document.getElementById(("news2Text")).innerHTML ="";
                                document.getElementById(("news3Text")).innerHTML ="";

                            });
                            $('.article-body').each((index,element) => {
                            element.innerHTML =
                                res.data[index].fields.body.split(' ').slice(0,30).join(' ') + '...';
                        });
        
                        }



                    });

                });


                $('#page_1').click( () => {
                    if (toggle_US==false) {
                        filters = 'filter[operator]=OR&filter[conditions][0][field]=country&filter[conditions][0][value]=USA&filter[conditions][0][negate]=true&filter[conditions][1][field]=body&profile=full&limit=3' 
                    }
                    else {
                        filters = 'filter[operator]=AND&filter[conditions][0][field]=country&filter[conditions][0][value]=USA&filter[conditions][1][field]=body&profile=full&limit=3'
                    }
                    $.ajax({    
                        url: 'https://api.reliefweb.int/v1/reports?appname=apidoc&query[value]=wildfire&' + filters,    
                        type: 'GET',
                        dataType: 'json',
                        success: (res) => {
                            console.log(res);
                            articles = res;
                            $('.article-header').each((index,element) => {
                                console.log('U.S. clicked!');
                                element.innerHTML = res.data[index].fields.title
                                document.getElementById(("news1Text")).innerHTML ="";
                                document.getElementById(("news2Text")).innerHTML ="";
                                document.getElementById(("news3Text")).innerHTML ="";

                            });
                            $('.article-body').each((index,element) => {
                            element.innerHTML =
                                res.data[index].fields.body.split(' ').slice(0,30).join(' ') + '...';
                        });

                        $("#page_2").css("background-color", "#F5F5F5");
                        $("#page_1").css("background-color", "#71eeb8");
                        $("#page_3").css("background-color", "#F5F5F5");
        
                        }



                    });

                });


                $('#page_2').click( () => {
                    if (toggle_US==false) {
                        filters = 'filter[operator]=OR&filter[conditions][0][field]=country&filter[conditions][0][value]=USA&filter[conditions][0][negate]=true&filter[conditions][1][field]=body&profile=full&limit=3' 
                    }
                    else {
                        filters = 'filter[operator]=AND&filter[conditions][0][field]=country&filter[conditions][0][value]=USA&filter[conditions][1][field]=body&profile=full&limit=3'
                    }
                    $.ajax({    
                        url: 'https://api.reliefweb.int/v1/reports?appname=apidoc&query[value]=crime&' + filters,    
                        type: 'GET',
                        dataType: 'json',
                        success: (res) => {
                            console.log(res);
                            articles = res;
                            $('.article-header').each((index,element) => {
                                console.log('U.S. clicked!');
                                element.innerHTML = res.data[index].fields.title
                                document.getElementById(("news1Text")).innerHTML ="";
                                document.getElementById(("news2Text")).innerHTML ="";
                                document.getElementById(("news3Text")).innerHTML ="";

                            });
                            $('.article-body').each((index,element) => {
                            element.innerHTML =
                                res.data[index].fields.body.split(' ').slice(0,30).join(' ') + '...';
                        });

                        $("#page_2").css("background-color", "#71eeb8");
                        $("#page_1").css("background-color", "#F5F5F5");
                        $("#page_3").css("background-color", "#F5F5F5");
                        
        
                        }



                    });

                });



                $('#page_3').click( () => {
                    if (toggle_US==false) {
                        filters = 'filter[operator]=OR&filter[conditions][0][field]=country&filter[conditions][0][value]=USA&filter[conditions][0][negate]=true&filter[conditions][1][field]=body&profile=full&limit=3' 
                    }
                    else {
                        filters = 'filter[operator]=AND&filter[conditions][0][field]=country&filter[conditions][0][value]=USA&filter[conditions][1][field]=body&profile=full&limit=3'
                    }
                    $.ajax({    
                        url: 'https://api.reliefweb.int/v1/reports?appname=apidoc&query[value]=flood&' + filters,    
                        type: 'GET',
                        dataType: 'json',
                        success: (res) => {
                            console.log(res);
                            articles = res;
                            $('.article-header').each((index,element) => {
                                console.log('U.S. clicked!');
                                element.innerHTML = res.data[index].fields.title
                                document.getElementById(("news1Text")).innerHTML ="";
                                document.getElementById(("news2Text")).innerHTML ="";
                                document.getElementById(("news3Text")).innerHTML ="";

                            });
                            $('.article-body').each((index,element) => {
                            element.innerHTML =
                                res.data[index].fields.body.split(' ').slice(0,30).join(' ') + '...';
                        });


                        $("#page_2").css("background-color", "#F5F5F5");
                        $("#page_1").css("background-color", "#F5F5F5");
                        $("#page_3").css("background-color", "#71eeb8");
        
                        }




                    });

                });


                $('#page_4').click( () => {
                    if (toggle_US==false) {
                        filters = 'filter[operator]=OR&filter[conditions][0][field]=country&filter[conditions][0][value]=USA&filter[conditions][0][negate]=true&filter[conditions][1][field]=body&profile=full&limit=3' 
                    }
                    else {
                        filters = 'filter[operator]=AND&filter[conditions][0][field]=country&filter[conditions][0][value]=USA&filter[conditions][1][field]=body&profile=full&limit=3'
                    }
                    $.ajax({    
                        url: 'https://api.reliefweb.int/v1/reports?appname=apidoc&query[value]=earthquake&' + filters,    
                        type: 'GET',
                        dataType: 'json',
                        success: (res) => {
                            console.log(res);
                            articles = res;
                            $('.article-header').each((index,element) => {
                                console.log('U.S. clicked!');
                                element.innerHTML = res.data[index].fields.title
                                document.getElementById(("news1Text")).innerHTML ="";
                                document.getElementById(("news2Text")).innerHTML ="";
                                document.getElementById(("news3Text")).innerHTML ="";

                            });
                            $('.article-body').each((index,element) => {
                            element.innerHTML =
                                res.data[index].fields.body.split(' ').slice(0,30).join(' ') + '...';
                        });
        
                        }



                    });

                });


                //Individual Page Linking

                $('#news1').click( () => {
                    window.location.href= '/news1Profile.html'

                });

});
        </script>
    </head>

    <body>
        <div id="topNews">
            <img class="logoSize" src="./transparent_Logo.png" alt="logo">
        </div>


        <div class="back-button">
            <button id="logoutBut" type="button" class="btn btn-light">
                <a class="back" href="login.html">Logout</a>
            </button>  
        </div>



        <form id="topNews">
            <button id="butNewsUS" type="button" class="btn btn-primary" data-toggle="button" aria-pressed="false" autocomplete="off">
                US
            </button>
            <button id="butNewsWorld" type="button" class="btn btn-primary" data-toggle="button" aria-pressed="false" autocomplete="off">
                World
            </button>
        </form>



        <div class="article-card">
            <div class="newStyle" id="news1">
                <img class="newsStyle" src="./news1Pic.jpg" alt="news1">
            </div>
            <h3 class="article-header"></h3>
            <p class="article-body" id="news1Text"></p>
            <button id="learnBut1" type="button" class="btn btn-cust learnBut">Learn More
            </button>

        </div>

        <div class="article-card">
            <div class="newStyle" id="news2">
                <img class="newsStyle" src="./news1Pic.jpg" alt="news2">
            </div>
            <h3 class="article-header"></h3>

            <p class="article-body" id="news2Text"></p>
            <button id="learnBut2" type="button" class="btn btn-cust learnBut">Learn More</button>
        </div>



        <div class="article-card">
            <div class="newStyle" id="news3">
                <img class="newsStyle" src="./news1Pic.jpg" alt="news3">
            </div>
            <h3 class="article-header"></h3>

            <p class="article-body" id="news3Text"></p>
            <button id="learnBut3" type="button" class="btn btn-cust learnBut">Learn More</button>
        </div>

        <nav aria-label="Page navigation example" >
            <ul id="pageScroll" class="pagination">
            
                <!-- 
                <li class="page-item"><button id="page_0" type="button" class="btn btn-nav" data-toggle="button" aria-pressed="false" autocomplete="off">
                    1
                            </button></li>

                -->
                <li class="page-item"><button id="page_1" type="button" class="btn btn-nav" data-toggle="button" aria-pressed="false" autocomplete="off">
        1
                </button></li>
                <li class="page-item"><button id="page_2" type="button" class="btn btn-nav" data-toggle="button" aria-pressed="false" autocomplete="off">
                    2
                            </button></li>
                <li class="page-item"><button id="page_3" type="button" class="btn btn-nav" data-toggle="button" aria-pressed="false" autocomplete="off">
                    3
                            </button></li>

                <!-- 
                <li class="page-item"><button id="page_4" type="button" class="btn btn-nav" data-toggle="button" aria-pressed="false" autocomplete="off">
                    Next
                            </button></li>

                -->
            </ul>
        </nav>

    </body>

</html>
